<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		<script src="/fallout-fission/assets/jquery.teletype.js"></script>
<script>
$(function() {
    $('.appDescriptionContainer .type-text').each(function() {

        var titleText = $(this).attr('title') || '';
        var bodyText  = $(this).text() || '';

        var combined = titleText + (titleText && bodyText ? ';' : '') + bodyText;

        var items = $.map(combined.split(';'), function(item) {
            return $.trim(item);
        }).filter(function(item) {
            return item.length > 0;
        });

        $(this)
            .empty()
            .removeAttr('title')
            .teletype({
                text: items,
                typeDelay: 10,
                backDelay: 20,
                humanise: true,
                cursor: '▋',
                delay: 3000,
                preserve: false,
                prefix: '',
                loop: false
            });
    });
});
</script>
<script>
$(function() {

  const terminal = document.querySelector('.terminal-band');
  if (!terminal) return;

  const observer = new IntersectionObserver(function(entries, obs) {

    entries.forEach(entry => {

      if (entry.isIntersecting) {

        const $band = $('.terminal-band');
        const $machine = $('.terminal-band .type-text-machine');

        if ($band.data('started')) return;
        $band.data('started', true);

        // Fade in band
        $band.addClass('active');

        // Power flicker
        setTimeout(function() {
          $band.addClass('power-on');
        }, 150);

        // Start typing
        setTimeout(function() {

          $machine.each(function() {

            const items = $(this).attr('title');

            $(this)
              .empty()
              .attr('title', '')
              .teletype({
                text: [ items ],
                typeDelay: 5,
				backDelay: 0,
                humanise: false,
                cursor: '▋',
                preserve: true,
                loop: false
              });

          });

        }, 500);

        obs.disconnect();

      }

    });

  }, {
    threshold: 0.35
  });

  observer.observe(terminal);

});
</script>

{% if site.ios_app_id %}

<script type="text/javascript" src="/fallout-fission/assets/zoom.js"></script>
<script>

$(function() {

    var apiURL = "https://itunes.apple.com/lookup?id={{ site.ios_app_id }}&country={{ site.ios_app_country }}&callback=?";

    $.getJSON(apiURL, function(json) {

        if (json.results && json.results.length) {

            console.info("Image strings loaded from Apple API.");
            var appInfo = json.results[0];

            // Set favicon
            $('link[rel="shortcut icon"]').attr("href", appInfo.artworkUrl512);

            // Set page title using the iOS app ID if it is not set manually in _config.yml
            var $pageTitle = $(".pageTitle");
            if ($.trim($($pageTitle).text()).length == 0) {
                $($pageTitle).html(appInfo.trackName);
            }

            // Set large app icon using the iOS app ID if it is not set manually in _config.yml
            var $appIconLarge = $(".appIconLarge");
            if (!$appIconLarge.attr('src')) {
                $($appIconLarge).attr("src", appInfo.artworkUrl512);
            }

            // Set header app icon using the iOS app ID if it is not set manually in _config.yml
            var $appIconHeader = $(".headerIcon");
            if (!$appIconHeader.attr('src')) {
                $($appIconHeader).attr("src", appInfo.artworkUrl512);
            }

            // Set app name using the iOS app ID if it is not set manually in _config.yml
            var $appName = $(".appName");
            if ($.trim($($appName).text()).length == 0) {
                $($appName).html(appInfo.trackName);
            }

            // Set the name displayed in the header if it is not set manually in _config.yml
            var $headerName = $(".headerName");
            if ($.trim($($headerName).text()).length == 0) {
                $($headerName).html(appInfo.trackName);
            }

            // Set price using the iOS app ID if it is not set manually in _config.yml
            var $appPrice = $(".appPrice");
            if ($.trim($($appPrice).text()).length == 0) {
                $($appPrice).html(appInfo.formattedPrice);
            }

            // Set App Store link using the iOS app ID if it is not set manually in _config.yml
            var $appStoreLink = $(".appStoreLink");
            if ($.trim($appStoreLink.attr('href')).length == 0) {
                $($appStoreLink).attr("href", appInfo.trackViewUrl);
            }

            console.info(appInfo);

        }
    });  
});

</script>

{% endif %}
